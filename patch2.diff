diff --git a/calc_hash.sh b/calc_hash.sh
new file mode 100644
index 0000000..e230e21
--- /dev/null
+++ b/calc_hash.sh
@@ -0,0 +1,2 @@
+#!/bin/bash
+git status > /dev/null 2>&1 && git rev-parse HEAD || echo NO_GIT_COMMIT_HASH_DEFINED
diff --git a/hash_version.sh b/hash_version.sh
index 5d52bd1..b014be5 100644
--- a/hash_version.sh
+++ b/hash_version.sh
@@ -1,6 +1,6 @@
 #!/bin/bash

-GIT_HASH=`git rev-parse HEAD`;
+GIT_HASH=`sh ./calc_hash.sh`;

 rm -f ver
 sed -b "s/NO_GIT_COMMIT_HASH_DEFINED/$GIT_HASH$1/" renderdoc/data/resource.h > ver && mv ver renderdoc/data/resource.h
diff --git a/renderdoc/Makefile b/renderdoc/Makefile
index fc7ffac..3c5da50 100644
--- a/renderdoc/Makefile
+++ b/renderdoc/Makefile
@@ -1,6 +1,6 @@
 CC=gcc
 CPP=g++
-COMMIT=`git rev-parse HEAD`
+COMMIT=`sh ../calc_hash.sh`
 MACROS=-DLINUX \
 			 -DRENDERDOC_PLATFORM=linux \
 			 -DRENDERDOC_EXPORTS \
diff --git a/renderdoc/driver/gl/Makefile b/renderdoc/driver/gl/Makefile
index 2552d95..abc1209 100644
--- a/renderdoc/driver/gl/Makefile
+++ b/renderdoc/driver/gl/Makefile
@@ -1,6 +1,6 @@
 CC=gcc
 CPP=g++
-COMMIT=`git rev-parse HEAD`
+COMMIT=`sh ../../../calc_hash.sh`
 MACROS=-DLINUX \
 			 -DRENDERDOC_PLATFORM=linux \
 			 -DRENDERDOC_EXPORTS \
diff --git a/renderdoc/driver/shaders/spirv/Makefile b/renderdoc/driver/shaders/spirv/Makefile
index deed81d..ea61c09 100644
--- a/renderdoc/driver/shaders/spirv/Makefile
+++ b/renderdoc/driver/shaders/spirv/Makefile
@@ -1,6 +1,6 @@
 CC=gcc
 CPP=g++
-COMMIT=`git rev-parse HEAD`
+COMMIT=`sh ../../../../calc_hash.sh`
 MACROS=-DLINUX \
 			 -DRENDERDOC_PLATFORM=linux \
 			 -DRENDERDOC_EXPORTS \
diff --git a/renderdoc/driver/vulkan/Makefile b/renderdoc/driver/vulkan/Makefile
index 6491cf3..3f2c426 100644
--- a/renderdoc/driver/vulkan/Makefile
+++ b/renderdoc/driver/vulkan/Makefile
@@ -1,6 +1,6 @@
 CC=gcc
 CPP=g++
-COMMIT=`git rev-parse HEAD`
+COMMIT=`sh ../../../calc_hash.sh`
 MACROS=-DLINUX \
 			 -DRENDERDOC_PLATFORM=linux \
 			 -DRENDERDOC_EXPORTS \
diff --git a/renderdoccmd/Makefile b/renderdoccmd/Makefile
index 94af9ef..88d1100 100644
--- a/renderdoccmd/Makefile
+++ b/renderdoccmd/Makefile
@@ -1,6 +1,6 @@
 CC=gcc
 CPP=g++
-COMMIT=`git rev-parse HEAD`
+COMMIT=`sh ../calc_hash.sh`
 MACROS=-DLINUX \
 			 -DRENDERDOC_PLATFORM=linux \
 			 -DGIT_COMMIT_HASH="\"$(COMMIT)\""
